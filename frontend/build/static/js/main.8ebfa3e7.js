/*! For license information please see main.8ebfa3e7.js.LICENSE.txt */
(()=>{"use strict";var e={4:(e,t,s)=>{var a=s(853),r=s(43),n=s(950);function o(e){var t="https://dohody-v2.preview.emergentagent.com","/api"),Fu=e=>{let{onLogin:t,setUser:s,authView:a,setAuthView:n}=e;const[o,i]=(0,r.useState)(!0),[l,c]=(0,r.useState)({email:"",password:"",username:"",gender:"male"}),[u,h]=(0,r.useState)(!1),[m,x]=(0,r.useState)("");if("password-reset"===a)return(0,Gt.jsx)(Du,{onBackToLogin:()=>n("login")});return(0,Gt.jsx)("div",{className:"min-h-screen bg-gradient-primary flex items-center justify-center p-8 min-h-app",children:(0,Gt.jsxs)("div",{className:"bg-surface-card border border-border-primary rounded-xl p-8 max-w-md w-full",children:[(0,Gt.jsxs)("div",{className:"flex flex-col items-center mb-2",children:[(0,Gt.jsx)("img",{src:"/gems/gem-green.svg",alt:"GemPlay Logo",className:"w-16 h-16 mb-4"}),(0,Gt.jsx)("h1",{className:"font-russo text-3xl text-accent-primary text-center",children:"GemPlay"})]}),(0,Gt.jsx)("p",{className:"font-roboto text-text-secondary text-center mb-6",children:"PvP NFT Gem Battle Game"}),(0,Gt.jsxs)("div",{className:"flex mb-6",children:[(0,Gt.jsx)("button",{onClick:()=>i(!0),className:"flex-1 py-2 px-4 rounded-l-lg font-rajdhani font-bold transition-colors ".concat(o?"bg-accent-primary text-white":"bg-surface-sidebar text-text-secondary"),children:"LOGIN"}),(0,Gt.jsx)("button",{onClick:()=>i(!1),className:"flex-1 py-2 px-4 rounded-r-lg font-rajdhani font-bold transition-colors ".concat(o?"bg-surface-sidebar text-text-secondary":"bg-accent-primary text-white"),children:"REGISTER"})]}),(0,Gt.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),h(!0);try{if(o){const e=await Pt.post("".concat(Bu,"/auth/login"),{email:l.email,password:l.password});localStorage.setItem("token",e.data.access_token),e.data.refresh_token&&localStorage.setItem("refresh_token",e.data.refresh_token),s(e.data.user),t(e.data.user),qt.initializeSounds(e.data.user.role),h(!1),n("login")}else{const e=Wt(l.username);if(!e.isValid)return void alert(e.errors[0]);const s=await Pt.post("".concat(Bu,"/auth/register"),{username:l.username,email:l.email,password:l.password,gender:l.gender});alert("Registration successful! Verification token: ".concat(s.data.verification_token)),await Pt.post("".concat(Bu,"/auth/verify-email"),{token:s.data.verification_token});const a=await Pt.post("".concat(Bu,"/auth/login"),{email:l.email,password:l.password});localStorage.setItem("token",a.data.access_token),a.data.refresh_token&&localStorage.setItem("refresh_token",a.data.refresh_token),t(a.data.user)}}catch(a){a.response?alert("Login failed: ".concat(a.response.data.detail||a.message)):alert("Network error: ".concat(a.message))}finally{h(!1)}},className:"space-y-4",children:[!o&&(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("input",{type:"text",placeholder:"Username",value:l.username,onChange:e=>{Vt(e.target.value,(e=>c(d(d({},l),{},{username:e}))),x)},className:"w-full px-4 py-3 bg-surface-sidebar border rounded-lg text-white font-roboto ".concat(m?"border-red-500":"border-border-primary"),required:!0}),m&&(0,Gt.jsx)("p",{className:"mt-1 text-xs text-red-400 font-roboto",children:m})]}),(0,Gt.jsxs)("select",{value:l.gender,onChange:e=>c(d(d({},l),{},{gender:e.target.value})),className:"w-full px-4 py-3 bg-surface-sidebar border border-border-primary rounded-lg text-white font-roboto",children:[(0,Gt.jsx)("option",{value:"male",children:"Male"}),(0,Gt.jsx)("option",{value:"female",children:"Female"})]})]}),(0,Gt.jsx)("input",{type:"email",placeholder:"Email",value:l.email,onChange:e=>c(d(d({},l),{},{email:e.target.value})),className:"w-full px-4 py-3 bg-surface-sidebar border border-border-primary rounded-lg text-white font-roboto",required:!0}),(0,Gt.jsx)("input",{type:"password",placeholder:"Password",value:l.password,onChange:e=>c(d(d({},l),{},{password:e.target.value})),className:"w-full px-4 py-3 bg-surface-sidebar border border-border-primary rounded-lg text-white font-roboto",required:!0}),(0,Gt.jsx)("button",{type:"submit",disabled:u,className:"w-full py-3 bg-gradient-accent text-white font-rajdhani font-bold text-lg rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50",children:u?"LOADING...":o?"LOGIN":"REGISTER"}),(0,Gt.jsxs)("div",{className:"mt-4",children:[(0,Gt.jsxs)("div",{className:"relative",children:[(0,Gt.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Gt.jsx)("div",{className:"w-full border-t border-border-primary"})}),(0,Gt.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Gt.jsx)("span",{className:"px-2 bg-surface-primary text-text-secondary font-roboto",children:"\u0438\u043b\u0438"})})]}),(0,Gt.jsx)("div",{className:"mt-4",children:(0,Gt.jsx)(Ru,{onLogin:t,onError:e=>alert(e)})})]}),o&&(0,Gt.jsx)("div",{className:"text-center mt-4",children:(0,Gt.jsx)("button",{type:"button",onClick:()=>n("password-reset"),className:"text-accent-primary hover:text-accent-primary/80 font-roboto text-sm",children:"\u0417\u0430\u0431\u044b\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c?"})})]})]})})};const Wu=function(){const[e,t]=(0,r.useState)(null),[s,a]=(0,r.useState)("lobby"),[n,o]=(0,r.useState)(!1),[i,l]=(0,r.useState)(!0),[c,d]=(0,r.useState)("login"),[u,h]=(0,r.useState)(!1),m=((0,r.useRef)(0),async()=>{const e=localStorage.getItem("token"),s=localStorage.getItem("refresh_token");if(e)try{const s=await Pt.get("".concat(Bu,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});t(s.data),qt.initializeSounds(s.data.role),l(!1)}catch(n){var a;if(401===(null===(a=n.response)||void 0===a?void 0:a.status)&&s)try{const e=await Pt.post("".concat(Bu,"/auth/refresh"),{refresh_token:s},{headers:{"Content-Type":"application/json"}});return localStorage.setItem("token",e.data.access_token),e.data.refresh_token&&localStorage.setItem("refresh_token",e.data.refresh_token),t(e.data.user),qt.initializeSounds(e.data.user.role),void l(!1)}catch(o){var r;console.error("Token refresh failed:",(null===(r=o.response)||void 0===r?void 0:r.data)||o.message)}localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),l(!1)}else l(!1)});(0,r.useEffect)((()=>{m()}),[]),(0,r.useEffect)((()=>{const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};return e(),window.addEventListener("orientationchange",e,{passive:!0}),()=>window.removeEventListener("orientationchange",e)}),[]);const x=e=>{t(e),l(!1)},p=()=>{o(!0)},f=()=>{localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),t(null),a("lobby"),o(!1)};return i?(0,Gt.jsx)("div",{className:"min-h-screen bg-gradient-primary flex items-center justify-center",children:(0,Gt.jsx)("div",{className:"text-white text-xl font-roboto",children:"Loading..."})}):e?(0,Gt.jsx)(Kt,{children:(0,Gt.jsx)(ds,{children:n?(0,Gt.jsx)(Pu,{user:e,onClose:()=>{o(!1)}}):(0,Gt.jsxs)("div",{className:"min-h-screen bg-gradient-primary flex min-h-app",children:[(0,Gt.jsx)("div",{className:"hidden md:block",children:(0,Gt.jsx)(rs,{currentView:s,setCurrentView:a,user:e,isCollapsed:u,setIsCollapsed:h,onOpenAdminPanel:p,onLogout:f})}),(0,Gt.jsxs)("div",{className:"flex-1 flex flex-col min-h-screen",children:[(0,Gt.jsx)("nav",{className:"sticky top-0 z-40 bg-surface-sidebar border-b border-border-primary p-4 flex-shrink-0 hidden md:block",children:(0,Gt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Gt.jsx)("div",{className:"block",children:(0,Gt.jsx)("h1",{className:"text-xl font-russo text-text-primary capitalize",children:"notifications"===s?"Notifications":"my-bets"===s?"My Bets":s})}),(0,Gt.jsx)("div",{className:"block",children:(0,Gt.jsx)(Hs,{user:e})})]})}),(0,Gt.jsx)(zu,{currentView:s,setCurrentView:a,user:e,onOpenAdminPanel:p,onLogout:f,totalBalance:e?(e.virtual_balance||0)+(e.frozen_balance||0):0}),(0,Gt.jsx)("div",{className:"flex-1 overflow-auto pb-20 md:pb-0",children:(0,Gt.jsxs)("div",{className:"min-w-0 px-4 md:px-0",children:["lobby"===s&&(0,Gt.jsx)(Fs,{user:e,onUpdateUser:m,setCurrentView:a}),"my-bets"===s&&(0,Gt.jsx)(Vs,{user:e,onUpdateUser:m}),"profile"===s&&(0,Gt.jsx)(Ys,{user:e,onUpdateUser:m,setCurrentView:a,onOpenAdminPanel:p,onLogout:f}),"shop"===s&&(0,Gt.jsx)(Ks,{user:e,onUpdateUser:m}),"inventory"===s&&(0,Gt.jsx)(ea,{user:e,onUpdateUser:m}),"history"===s&&(0,Gt.jsx)(sa,{user:e,onUpdateUser:m}),"notifications"===s&&(0,Gt.jsx)(Iu,{})]})})]}),(0,Gt.jsx)("div",{className:"md:hidden fixed bottom-0 left-0 right-0 z-50 bg-surface-sidebar border-t border-border-primary",children:(0,Gt.jsxs)("div",{className:"flex items-center justify-around py-2 px-4",children:[(0,Gt.jsx)("button",{onClick:()=>a("lobby"),className:"flex flex-col items-center py-2 px-3 rounded-lg transition-all duration-300 ".concat("lobby"===s?"text-accent-primary bg-accent-primary/10":"text-gray-400 hover:text-white"),children:(0,Gt.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}),(0,Gt.jsx)("button",{onClick:()=>a("my-bets"),className:"flex flex-col items-center py-2 px-3 rounded-lg transition-all duration-300 ".concat("my-bets"===s?"text-accent-primary bg-accent-primary/10":"text-gray-400 hover:text-white"),children:(0,Gt.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,Gt.jsx)("button",{onClick:()=>a("shop"),className:"flex flex-col items-center py-2 px-3 rounded-lg transition-all duration-300 ".concat("shop"===s?"text-accent-primary bg-accent-primary/10":"text-gray-400 hover:text-white"),children:(0,Gt.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z"})})}),(0,Gt.jsx)("button",{onClick:()=>a("inventory"),className:"flex flex-col items-center py-2 px-3 rounded-lg transition-all duration-300 ".concat("inventory"===s?"text-accent-primary bg-accent-primary/10":"text-gray-400 hover:text-white"),children:(0,Gt.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),(0,Gt.jsx)("button",{onClick:()=>a("leaderboard"),className:"flex flex-col items-center py-2 px-3 rounded-lg transition-all duration-300 ".concat("leaderboard"===s?"text-accent-primary bg-accent-primary/10":"text-gray-400 hover:text-white"),children:(0,Gt.jsx)("svg",{className:"w-6 h-6 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})})]})}),(0,Gt.jsx)(yu,{})]})})}):(0,Gt.jsx)(Fu,{onLogin:x,setUser:t,authView:c,setAuthView:d})};let Vu=!1,Uu=[];const Hu=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{return e.includes("/auth/login")||e.includes("/auth/register")||e.includes("/auth/refresh")}catch(t){return!1}},qu=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Uu.forEach((s=>{e?s.reject(e):s.resolve(t)})),Uu=[]};Pt.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&!Hu(null===e||void 0===e?void 0:e.url)&&(e.headers.Authorization="Bearer ".concat(t)),e}),(e=>Promise.reject(e))),Pt.interceptors.response.use((e=>e),(async e=>{var t,s;const a=e.config||{};if(401===(null===(t=e.response)||void 0===t?void 0:t.status)&&Hu(a.url)){try{localStorage.removeItem("token"),localStorage.removeItem("refresh_token")}catch(r){}return Promise.reject(e)}if(401===(null===(s=e.response)||void 0===s?void 0:s.status)&&!a._retry){if(Vu)return new Promise(((e,t)=>{Uu.push({resolve:e,reject:t})})).then((e=>(a.headers=a.headers||{},a.headers.Authorization="Bearer ".concat(e),Pt(a)))).catch((e=>Promise.reject(e)));a._retry=!0,Vu=!0;const t=localStorage.getItem("refresh_token");if(!t)return Gu(),Promise.reject(e);try{const e=await Pt.post("".concat(Xd,"/auth/refresh"),{refresh_token:t},{headers:{"Content-Type":"application/json"}}),{access_token:s,refresh_token:r}=e.data;return localStorage.setItem("token",s),r&&localStorage.setItem("refresh_token",r),Pt.defaults.headers.common.Authorization="Bearer ".concat(s),qu(null,s),a.headers=a.headers||{},a.headers.Authorization="Bearer ".concat(s),Pt(a)}catch(n){return qu(n,null),Gu(),Promise.reject(n)}finally{Vu=!1}}return Promise.reject(e)}));const Gu=()=>{localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),window.showErrorRU&&window.showErrorRU("Session expired. Please sign in again."),"/"!==window.location.pathname&&window.location.reload()};n.createRoot(document.getElementById("root")).render((0,Gt.jsx)(r.StrictMode,{children:(0,Gt.jsx)(Wu,{})}))})();
//# sourceMappingURL=main.8ebfa3e7.js.map